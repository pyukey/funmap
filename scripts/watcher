#!/bin/bash
start()
{
  path="$(pwd)"
  echo "$path"
  files=($path/*)
  while true; do
    watcher
    sleep 15
  done
}
execute()
{
  num=$(grep -n "---" "$1" | awk '{print $1}')
  while IFS= read -r ip; do
    while IFS= read -r script; do
      echo "Running $script on $ip"
    done < <(tail -n "+$((num + 1))" "$1")
  done < <(head -n "$((num - 1))" "$1")
}
watcher()
{
  for f in $path/*; do
    if [[ ! "${files[@]}" =~ "$f" ]]; then
      execute $f
    fi
  done
  files=($path/*)
}

start
