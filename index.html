<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
    content="width=device-width, initial-scale=1.0">
    <title>Funmap</title>
 
    <link rel="stylesheet" href="styles.css" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/cytoscape/2.7.10/cytoscape.js'></script>
    <script src="clicks.js"></script>
</head>
<body>
    <header>
    </header>
    <main>
        <div class="toggle">
            <div class="toggle-options">
                <div class="clickable" id="remove-edge-btn">Remove Edge</div>
                <div class="sep-line"></div>
                <div class="clickable" id="add-edge-btn">Add Edge</div>
            </div>
        </div>
        <div class="bulk">
            <div class="graph" id="network"></div>
            <div class="info-box right smol" id="repo">
                <span class="material-symbols-outlined arrow" id = 'arrow1'>
                    keyboard_arrow_down
                    </span>
                <ul id="propertiesDesc"><h3>Properties</h3>
		    <li id="ipDesc">IP</li>
		    <li id="hostnameDesc">hostname</li>
		    <li id="distroDesc">distro</li>
		</ul>
                <ul id="servicesDesc"><h3>Services</h3>
		    <li>SSH</li>
		</ul>
                <ul id="defaultCredsDesc"><h3>Default Creds</h3>
		    <li id="userDesc">user</li>
		    <li id="passDesc">password123</li>
		</ul>
                <ul id="passwdDesc"><h3>Passwords</h3>
		    <li>username: password</li>
		</ul>
            </div>
        </div>
    </main>
 
    <!-- handle clicks -->
    <script>
        var arrow1 = document.getElementById('arrow1');
 
        arrow1.addEventListener('click', function() {toggleIcon(arrow1);});
    </script>
 
    <!-- visualizer -->
    <script>
        var la = cytoscape({
            container: document.getElementById('network'),
            style : [
                {
                    selector: 'node',
                    style: {
                        shape: 'rectangle',
                        'background-color': 'white',
                        'background-image': 'data(image)',
                        'background-fit': 'cover',
                        'background-clip': 'none',
                        label: 'data(label)',
                        'text-valign': 'bottom',
                        'text-halign': 'center',
                        'color': '#000000',
                        'text-wrap': 'wrap',
                        'text-background-color': 'white',
                        'text-background-opacity': 1,
                        'font-size': 2,
                        'width': 13,
                        'height': 13
                    }
                },
                {
                    selector: 'node:selected',
                    style: {
                        'background-color': '#A6FFB0'
                    }
                },
                {
                    selector: '.defaultCreds',
                    style: {
                        'background-color': '#FFA6A6'
                    }
                },
                {
                    selector: '.router',
                    style: {
                        'font-size': 3,
                        'width': 18,
                        'height': 18
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 1
                    }
                }
            ],
            layout: {
                name: 'preset'
            },
            elements: [ 
                { data: { id: "10.13.37.1", hostname: "unknown", label: "10.13.37.1\nunknown", image: "assets/Windows.png", distro: "Windows" }, classes: "router", position: { x: 56, y: 0 } },
                { data: { id: "10.13.37.10", hostname:"blackmoon.nerv.ccdc",  label: "10.13.37.10\nblackmoon.nerv.ccdc", image: "assets/FreeBSD.png", distro: "FreeBSD" }, position: { x: 0, y: 25 } },
                { data: { id: "connect_10.13.37.10", source: "10.13.37.1", target: "10.13.37.10" } },
                { data: { id: "10.13.37.123", hostname:"unknown", label: "10.13.37.123\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 16, y: 25 } },
                { data: { id: "connect_10.13.37.123", source: "10.13.37.1", target: "10.13.37.123" } },
                { data: { id: "10.13.37.240", hostname:"ccdc1-engine", label: "10.13.37.240\nccdc1-engine", image: "assets/Kali.png", distro: "Kali" }, position: { x: 32, y: 25 } },
                { data: { id: "connect_10.13.37.240", source: "10.13.37.1", target: "10.13.37.240" } },
                { data: { id: "10.13.37.241", hostname:"vegetable.nerv.ccdc",  label: "10.13.37.241\nvegetable.nerv.ccdc", image: "assets/Ubuntu.png", distro: "Ubuntu" }, position: { x: 48, y: 25 } },
                { data: { id: "connect_10.13.37.241", source: "10.13.37.1", target: "10.13.37.241" } },
                { data: { id: "10.13.37.245", hostname:"unknown", label: "10.13.37.245\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 64, y: 25 } },
                { data: { id: "connect_10.13.37.245", source: "10.13.37.1", target: "10.13.37.245" } },
                { data: { id: "10.13.37.248", hostname:"fbi", label: "10.13.37.248\nfbi", image: "assets/Kali.png", distro: "Kali" }, position: { x: 80, y: 25 } },
                { data: { id: "connect_10.13.37.248", source: "10.13.37.1", target: "10.13.37.248" } },
                { data: { id: "10.13.37.250", hostname:"unknown", label: "10.13.37.250\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 96, y: 25 } },
                { data: { id: "connect_10.13.37.250", source: "10.13.37.1", target: "10.13.37.250" } },
                { data: { id: "10.13.37.251", hostname:"unknown", label: "10.13.37.251\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 112, y: 25 } },
                { data: { id: "connect_10.13.37.251", source: "10.13.37.1", target: "10.13.37.251" } },
                { data: { id: "10.13.37.252", hostname:"unknown", label: "10.13.37.252\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 40, y: 50 } },
                { data: { id: "connect_10.13.37.252", source: "10.13.37.1", target: "10.13.37.252" } },
                { data: { id: "10.13.37.61", hostname:"lilith.nerv.ccdc",  label: "10.13.37.61\nlilith.nerv.ccdc", image: "assets/Ubuntu.png", distro: "Ubuntu" }, position: { x: 56, y: 50 } },
                { data: { id: "connect_10.13.37.61", source: "10.13.37.1", target: "10.13.37.61" } },
                { data: { id: "10.13.37.9", hostname:"unknown", label: "10.13.37.9\nunknown", image: "assets/Windows.png", distro: "Windows" }, position: { x: 72, y: 50 } },
                { data: { id: "connect_10.13.37.9", source: "10.13.37.1", target: "10.13.37.9" } },
            ]});
            document.getElementById('remove-edge-btn').addEventListener('click', function () {
                const selectedEdges = la.edges(':selected');
                if (selectedEdges.length === 0) {
                    alert('No edge selected!');
                    return;
                }
                selectedEdges.remove();
            });
            document.getElementById('add-edge-btn').addEventListener('click', function () {
                const selectedNodes = la.nodes(':selected');
                if (selectedNodes.length !== 2) {
                    alert('Please select exactly 2 nodes.');
                    return;
                }
 
                const source = selectedNodes[0].id();
                const target = selectedNodes[1].id();
 
                const edgeId = 'connect_' + target + '_to_' + source;
 
                if (la.getElementById(edgeId).length > 0) {
                    alert('Edge already exists.');
                    return
                }
 
                la.add({
                    group: 'edges',
                    data: {
                        id: edgeId,
                        source: source,
                        target: target
                    }
                });
            });
            this.la.on('click', 'node', function (e) {
                document.getElementById("ipDesc").textContent = this.data().id
                document.getElementById("hostnameDesc").textContent = this.data().hostname
                document.getElementById("distroDesc").textContent = this.data().distro
		fetch("ip.json")
		  .then(response => response.json())
		  .then(json => {
		    document.getElementById("userDesc").textContent = json['defaultCreds']['user'];
		    document.getElementById("passDesc").textContent = json['defaultCreds']['passwd'];
		    
		    const ul = document.getElementById("servicesDesc");
		    ul.innerHTML = '<h3>Services</h3>';
		    for (const key in json['services']) {
		      const li = document.createElement("li");
		      li.innerHTML = json["services"][key]["name"]+' : '+json["services"][key]["port"] + ' - ' + json["services"][key]["version"];
		      ul.appendChild(li);
		    }

		    const ul2 = document.getElementById("passwdDesc");
		    ul2.innerHTML = '<h3>Passwords</h3>';
		    for (const key in json['passwords']) {
		      const li = document.createElement("li");
		      li.innerHTML = json["passwords"][key]["user"] +' : ' + json["passwords"][key]["passwd"]
		      ul2.appendChild(li);
		    }
		  });
            });
        </script>
    </body>
</html>
